{% if not ajax %} {% extends "base.html" %} {% endif %}
<!---->
{% from "macros.jinja" import window_vars with context %}
<!---->
{% block scripts %} {{ window_vars(user) }}{% endblock %} {% block page %}

<div class="row">
  <div class="col-12">
    <q-stepper
      v-model="step"
      ref="stepper"
      color="primary"
      animated
      class="q-pt-sm"
    >
      <q-step
        :name="0"
        title="Intro"
        icon="home"
        :done="step > 0"
        style="min-height: 100px"
      >
        <div class="row">
          <div class="col-12">
            <span>
              In order to better understand the terms used by the
              <q-badge>Extension Builder</q-badge> we are going to use the
              <q-badge outline>Campaign Donations Extension</q-badge> as an
              example.
            </span>
          </div>
          <div class="col-12">
            <span>The story is like this:</span>
            <ul>
              <li>
                An LNbits user wants to create a campaign to receive donations
                for a cause.
              </li>
              <li>
                The user creates a campaign with a name, description, goal
                amount and a deadline (it can create multiple campaigns).
              </li>
              <li>
                The user can share the campaign link with others to receive
                donations.
              </li>
              <li>
                People can donate to the campaign and view the total amount
                received using a public page (no need to login).
              </li>
              <li>
                Donors can leave their nostr nip5 indentifier and be notified
                when their payment has been processed.
              </li>
              <li>
                The user can view the list of donors and the amounts they
                donated.
              </li>
            </ul>
          </div>
          <div class="col-12">
            <span>
              In the following steps the
              <q-badge outline>Campaign Donations</q-badge> fields will be used
              as placeholders for the <code>inputs</code> in order to guide
              you.</span
            >
            <strong>You must fill in your own values.</strong>
          </div>
        </div>
      </q-step>

      <q-step
        :name="1"
        title="Describe"
        icon="info"
        :done="step > 1"
        style="min-height: 100px"
      >
        <div class="row q-col-gutter-md">
          <div class="col-md-8 col-sm-12">
            <q-img
              :src="'{{ static_url_for('static', 'images/builder/build_01.png') }}'"
            ></q-img>
          </div>
          <div class="col-md-4 col-sm-12">
            <span> Tell us something about your extension: </span>
            <ul>
              <li>This is the first step, you can return and change it.</li>
              <li>
                The <code>`name`</code> and
                <code>`sort description`</code> fields are what the users will
                see when browsing the list of extensions.
              </li>
              <li>
                The <code>`id`</code> field is used internally and in the URL of
                your extension.
              </li>
            </ul>
          </div>
          <!-- todo: add icon -->
        </div>
        <q-separator class="q-mt-sm"></q-separator>
        <div class="row q-col-gutter-md q-mt-md">
          <div class="col-md-4 col-sm-12">
            <q-input
              filled
              v-model="extensionData.name"
              label="Extension Name"
              hint="The name of your extension"
            >
            </q-input>
          </div>
          <div class="col-md-4 col-sm-12">
            <q-input
              filled
              v-model="extensionData.id"
              label="Extension Id"
              hint="Lowercase letters, numbers, and underscores only (snake_case). This will be used in the URL."
            >
            </q-input>
          </div>
          <div class="col-md-4 col-sm-12">
            <q-input
              filled
              v-model="extensionData.short_description"
              label="Short Description"
              hint="A short description that is shown in the extension list."
            >
            </q-input>
          </div>
        </div>
        <div class="row q-mt-lg">
          <div class="col-12">
            <q-input
              filled
              v-model="extensionData.description"
              label="Description"
              hint="A detailed description of your extension."
              type="textarea"
              rows="3"
              maxlength="1000"
            >
            </q-input>
          </div>
        </div>
      </q-step>

      <q-step
        :name="2"
        title="Settings"
        icon="settings"
        :done="step > 2"
        style="min-height: 100px"
      >
        <div class="row q-col-gutter-md q-mt-md">
          <div class="col-md-8 col-sm-12">
            <q-img
              :src="'{{ static_url_for('static', 'images/builder/build_02.png') }}'"
            ></q-img>
          </div>
          <div class="col-md-4 col-sm-12">
            <q-toggle
              v-model="extensionData.generate.settings"
              label="Generate Settings Fields"
              size="md"
              color="green"
            />
            <br />
            <ul>
              <li>Define what settings your extension will have.</li>
              <li>
                You can choose if each user has its own settings or if the
                settings are global (set by the admin).
              </li>
            </ul>
          </div>
        </div>

        <q-separator
          v-if="extensionData.generate.settings"
          class="q-mt-sm"
        ></q-separator>
        <div v-if="extensionData.generate.settings" class="row q-mt-lg">
          <div class="col-md-2 col-sm-12">
            <q-select
              filled
              dense
              emit-value
              map-options
              v-model="extensionData.settingsType"
              :options="settingsTypes"
            ></q-select>
          </div>
          <div class="col-md-10 col-sm-12 q-pt-sm">
            <q-badge
              v-if="extensionData.settingsType === 'user'"
              outline
              class="text-caption q-ml-md"
              >Each user can set its own settings for this extension.</q-badge
            >
            <q-badge v-else outline class="text-caption q-ml-md"
              >Settings are set by the admin and apply to all users of the
              extension</q-badge
            >
          </div>
        </div>
        <div v-if="extensionData.generate.settings" class="row q-mt-lg">
          <div class="col-12">
            <lnbits-data-fields
              :fields="extensionData.settingsFields"
              :hide-advanced="true"
            ></lnbits-data-fields>
          </div>
        </div>
      </q-step>

      <q-step
        :name="3"
        :done="step > 3"
        title="Owner Data"
        icon="list"
        style="min-height: 100px"
      >
        <div class="row q-col-gutter-md q-mt-md">
          <div class="col-md-8 col-sm-12">
            <q-img
              :src="'{{ static_url_for('static', 'images/builder/build_03.png') }}'"
            ></q-img>
          </div>
          <div class="col-md-4 col-sm-12">
            <q-toggle
              v-model="extensionData.generate.owner"
              label="Generate Owner Table"
              size="md"
              color="green"
            />
            <br />
            <q-input
              v-if="extensionData.generate.owner"
              filled
              label="Owner TableName"
              hint="CamelCase name for the owner data table (e.g. Campaign, PoS, etc.)"
              class="q-mb-xl"
            >
            </q-input>

            <ul>
              <li>
                The owner of the extension manages this data. It can add, remove
                and update instances of it.
              </li>

              <li>
                Some fileds are present by default, like
                <code>created_at</code>, <code>updated_at</code> and
                <code>extra</code>.
              </li>
            </ul>
          </div>
        </div>
        <q-separator
          v-if="extensionData.generate.owner"
          class="q-mt-sm"
        ></q-separator>
        <div v-if="extensionData.generate.owner" class="row q-mt-lg">
          <div class="col-12">
            <lnbits-data-fields
              :fields="extensionData.ownerFields"
            ></lnbits-data-fields>
          </div>
        </div>
      </q-step>

      <q-step
        :name="4"
        :done="step > 4"
        title="Customer Data"
        icon="blur_linear"
        style="min-height: 100px"
      >
        <div class="row q-col-gutter-md q-mt-md">
          <div class="col-md-8 col-sm-12">
            <q-img
              :src="'{{ static_url_for('static', 'images/builder/build_04.png') }}'"
            ></q-img>
          </div>
          <div class="col-md-4 col-sm-12">
            <q-toggle
              v-model="extensionData.generate.customer"
              label="Generate Customer Table"
              size="md"
              color="green"
            />
            <br />
            <q-input
              v-if="extensionData.generate.customer"
              filled
              label="Customer Table Name"
              hint="CamelCase name for the customer data table (e.g. Donation, Payment, etc.)"
              class="q-mb-xl"
            >
            </q-input>
            <ul>
              <li>
                This data is created by users of the extension. Usually when
                they submit a form or make a payment.
              </li>
              <li>
                The owner of the extension can view this data, but should not
                modify it.
              </li>
            </ul>
          </div>
        </div>
        <q-separator
          v-if="extensionData.generate.customer"
          class="q-mt-sm"
        ></q-separator>
        <div v-if="extensionData.generate.customer" class="row q-mt-lg">
          <div class="col-12">
            <lnbits-data-fields
              :fields="extensionData.client_fields"
            ></lnbits-data-fields>
          </div>
        </div>
      </q-step>

      <q-step
        :name="5"
        :done="step > 5"
        title="Public Pages"
        icon="link"
        style="min-height: 100px"
      >
        <div class="row q-col-gutter-md q-mt-md">
          <div class="col-md-8 col-sm-12">
            <q-img
              :src="'{{ static_url_for('static', 'images/builder/build_04.png') }}'"
            ></q-img>
          </div>
          <div class="col-md-4 col-sm-12 q-gutter-y-md">
            <q-toggle
              v-model="extensionData.public_page.has_public_page"
              label="Has Public Page"
              size="md"
              color="green"
            />
            <q-select
              filled
              dense
              emit-value
              map-options
              v-model="extensionData.public_page.owner_data_fields.name"
              :options="extensionData.ownerFields.map(f => f.name)"
            ></q-select>
            <q-select
              filled
              dense
              emit-value
              map-options
              v-model="extensionData.public_page.owner_data_fields.description"
              :options="extensionData.ownerFields.map(f => f.name)"
            ></q-select>
            <q-select
              filled
              dense
              emit-value
              map-options
              multiple
              hint="Fields will be shown as inputs in the public page form."
              v-model="extensionData.public_page.client_data_fields.public_inputs"
              :options="extensionData.client_fields.map(f => f.name)"
            ></q-select>
            <q-toggle
              v-model="extensionData.public_page.action_fields.generate_action"
              label="Generate Action Button"
              hint="If enabled, a button will be shown to perform an action (e.g. create invoice, make payment, etc.)"
              size="md"
              color="green"
            />
            <q-select
              filled
              dense
              emit-value
              map-options
              hint="The wallet where payments will be received."
              v-model="extensionData.public_page.wallet_id"
              :options="extensionData.client_fields.map(f => f.name)"
            ></q-select>
            <q-select
              filled
              dense
              emit-value
              map-options
              hint="The currency field. Empty if you want to use sats."
              v-model="extensionData.public_page.action_fields.currency"
              :options="extensionData.client_fields.map(f => f.name)"
            ></q-select>
            <q-select
              filled
              dense
              emit-value
              map-options
              hint="The amount field."
              v-model="extensionData.public_page.action_fields.amount"
              :options="extensionData.client_fields.map(f => f.name)"
            ></q-select>
          </div>
        </div>
      </q-step>
      <q-step
        :name="6"
        :done="step > 6"
        title="Review"
        icon="how_to_reg"
        style="min-height: 100px"
      >
        This is how your extension will look like.
      </q-step>
      <q-step
        :name="7"
        :done="step > 7"
        title="Publish"
        icon="publish"
        style="min-height: 100px"
      >
        Admins can publish to this server.
        <br />
        Regular users can download a zip file to install it in their own
        servers.
      </q-step>

      <template v-slot:navigation>
        <q-separator></q-separator>
        <div class="row">
          <div class="col q-pr-md q-pb-md">
            <q-stepper-navigation class="float-right">
              <q-btn
                v-if="step > 0"
                flat
                color="grey-8"
                class="q-mr-sm"
                @click="previousStep()"
                label="Back"
              />

              <q-btn
                @click="nextStep()"
                color="primary"
                :label="step === 7 ? 'Finish' : 'Next'"
              />
            </q-stepper-navigation>
          </div>
        </div>
      </template>
      <template v-slot:message>
        <q-banner v-if="step === 0" class="bg-grey-8 text-white q-px-lg">
          <span class="text-h5">New LNbits Extension</span><br />
          <span class="text-caption">
            This is a step-by-step guide to help you build your own LNbits
            extension.
          </span>
        </q-banner>
      </template>
    </q-stepper>
  </div>
</div>
<div class="row q-col-gutter-md"></div>
{% endblock %}
